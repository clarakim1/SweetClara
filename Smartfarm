/*
제주대학교 원예학과 조영열 교수님 스마트팜 특강
*/


#include <SoftwareSerial.h> 
#include <Wire.h> 
#include <LiquidCrystal_I2C.h> 

#define Water A0 
#define Relay 7 

SoftwareSerial mySerial(0, 1); 
LiquidCrystal_I2C lcd(0x27, 16, 2); // set the LCD address to 0x27 for a 16 chars and 2 line display 
String readString; 

void setup() { 
  // put your setup code here, to run once: 
  pinMode(Relay, OUTPUT); 
  Serial.begin(9600); 
  lcd.init();                      // initialize the lcd 
  lcd.init(); 
  // Print a message to the LCD. 
  lcd.backlight(); 
  lcd.setCursor(0, 0); 
  lcd.print("Hello, world!"); 
  lcd.setCursor(0, 1); 
  lcd.print("Happy Jeju"); 
  delay(5000); 
} 

void loop() { 
  // put your main code here, to run repeatedly: 
  int Water_Value = analogRead(Water); 
   int Water_Content = map(Water_Value, 0, 1023,0, 70);  //map(value, fromLow, fromHigh, toLow, toHigh)

  Serial.println(Water_Value); 

  lcd.clear(); 
  lcd.setCursor(0, 0); 
  lcd.print("Sensor Value="); 
  lcd.print(Water_Value); 
  lcd.setCursor(0, 1); 
   lcd.print("Water Con.="); 
     lcd.print(Water_Content); 
     lcd.print("%");    
  delay(1000); 

  if (Water_Value <= 240) { 
    digitalWrite(Relay, HIGH); 
    delay(1000); 
  } else { 
    digitalWrite(Relay, LOW); 
    delay(5000); 
  } 

  readString = ""; 
  String data = "Sensor Value="+String(Water_Value) + "," + String(Relay) + ","+"Water Content="+String(Water_Content)+"%"; 
  Serial.println(data); 

  while (Serial.available()) { 
    delay(3); 
    char c = Serial.read(); 
    readString += c; 
  } 

  if (readString.length() > 0) { 
    if (readString == "a") { 
      digitalWrite(Relay, HIGH); 
      delay(2000); 
    } 
    if (readString == "b") { 
      digitalWrite(Relay, LOW); 
      delay(2000); 
    } 
  } 
}
